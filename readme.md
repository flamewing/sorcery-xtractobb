# Badges

[![JSONT License: MIT](https://img.shields.io/badge/JSONT%20License-MIT-blue.svg)](https://tldrlegal.com/license/mit)
[![Other License: GPL v3](https://img.shields.io/badge/Other%20License-GPL%20v3-orange.svg)](https://www.gnu.org/licenses/gpl-3.0)

[![CodeFactor Grade](https://img.shields.io/codefactor/grade/github/flamewing/sorcery-xtractobb?label=codefactor&logo=codefactor&logoColor=white)](https://www.codefactor.io/repository/github/flamewing/sorcery-xtractobb)
[![LGTM Alerts](https://img.shields.io/lgtm/alerts/github/flamewing/sorcery-xtractobb?logo=LGTM)](https://lgtm.com/projects/g/flamewing/sorcery-xtractobb/alerts/)
[![LGTM Grade](https://img.shields.io/lgtm/grade/cpp/github/flamewing/sorcery-xtractobb?logo=LGTM)](https://lgtm.com/projects/g/flamewing/sorcery-xtractobb/context:cpp)

[![CI Mac OS Catalina 10.15](https://img.shields.io/github/workflow/status/flamewing/sorcery-xtractobb/ci-macos?label=CI%20Mac%20OS%20X&logo=Apple&logoColor=white)](https://github.com/flamewing/sorcery-xtractobb/actions?query=workflow%3Aci-macos)
[![CI Ubuntu 20.04](https://img.shields.io/github/workflow/status/flamewing/sorcery-xtractobb/ci-linux?label=CI%20Ubuntu&logo=Ubuntu&logoColor=white)](https://github.com/flamewing/sorcery-xtractobb/actions?query=workflow%3Aci-linux)
[![CI Windows Server 2019](https://img.shields.io/github/workflow/status/flamewing/sorcery-xtractobb/ci-windows?label=CI%20Windows&logo=Windows&logoColor=white)](https://github.com/flamewing/sorcery-xtractobb/actions?query=workflow%3Aci-windows)

[![Coverity Scan Analysis](https://img.shields.io/github/workflow/status/flamewing/sorcery-xtractobb/coverity-scan?label=Coverity%20Scan%20Analysis&logo=data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjU2IDI1MiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMjYuOTUgMTA5LjA4bC0zLjUyLTkuNDUgMzcuOTYgNzAuODloLjg1bDQ3LjMzLTExOC4xM2MuODMtMi41NiA4LjI2LTIxLjc0IDguNTEtMzAuMi42My0yMS44NC0xNC4xLTIzLjgxLTI5Ljc3LTE5LjM5QzM2Ljg3IDE5LjQ2LS4yNCA2Ny44My4wMSAxMjQuNzhjLjIgNTIuOTcgMzIuNjQgOTguMjQgNzguNjUgMTE3LjM4TDI2Ljk1IDEwOS4wOE0xNzQuMzMgNS40OGMtNi4zMiAxMi43LTEzLjEgMjYuMzctMjEuNjggNDguMDhMNzkuMjIgMjQyLjM5YzE1LjA5IDYuMiAzMS42MyA5LjYgNDguOTYgOS41MiA3MC41LS4yNyAxMjcuNDItNTcuNjcgMTI3LjEzLTEyOC4xOC0uMjItNTMuODMtMzMuNzYtOTkuNy04MC45OC0xMTguMjYiIGZpbGw9IiNmZmYiLz48L3N2Zz4=)](https://github.com/flamewing/sorcery-xtractobb/actions?query=workflow%3Acoverity-scan)
[![Coverity Scan](https://img.shields.io/coverity/scan/13717?label=Coverity%20Scan%20Results&logo=data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjU2IDI1MiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMjYuOTUgMTA5LjA4bC0zLjUyLTkuNDUgMzcuOTYgNzAuODloLjg1bDQ3LjMzLTExOC4xM2MuODMtMi41NiA4LjI2LTIxLjc0IDguNTEtMzAuMi42My0yMS44NC0xNC4xLTIzLjgxLTI5Ljc3LTE5LjM5QzM2Ljg3IDE5LjQ2LS4yNCA2Ny44My4wMSAxMjQuNzhjLjIgNTIuOTcgMzIuNjQgOTguMjQgNzguNjUgMTE3LjM4TDI2Ljk1IDEwOS4wOE0xNzQuMzMgNS40OGMtNi4zMiAxMi43LTEzLjEgMjYuMzctMjEuNjggNDguMDhMNzkuMjIgMjQyLjM5YzE1LjA5IDYuMiAzMS42MyA5LjYgNDguOTYgOS41MiA3MC41LS4yNyAxMjcuNDItNTcuNjcgMTI3LjEzLTEyOC4xOC0uMjItNTMuODMtMzMuNzYtOTkuNy04MC45OC0xMTguMjYiIGZpbGw9IiNmZmYiLz48L3N2Zz4=)](https://scan.coverity.com/projects/flamewing-sorcery-xtractobb)

[![Windows snapshot build](https://img.shields.io/github/workflow/status/flamewing/sorcery-xtractobb/snapshots-windows?label=Windows%20Snapshot%20build&logo=windows&logoColor=white)](https://github.com/flamewing/sorcery-xtractobb/actions?query=workflow%3Asnapshots-windows)
[![Latest Windows snapshot](https://img.shields.io/github/release-date/flamewing/sorcery-xtractobb?label=Latest%20Windows%20snapshot&logo=windows&logoColor=white)](https://github.com/flamewing/sorcery-xtractobb/releases/latest)

## Inkle Sorcery! Extractor

This software is capable of extracting the Android OBB files used in the Inkle Sorcery! series. It is possible that other Inkle games can also be extracted with this tool, but I did not test it.

To compile this tool you need a C++17-compatible compiler (GCC 7 is enough), as well as Boost. When you meet the requirements, run "make" and the "xtractobb" executable will be created. Its usage is:

    xtractobb <obbfile> <outputdir>

The tool will scan all files packed into the OBB and extract them into the output directory. It will also create a "SorceryN-Reference.json" file that stitches together "SorceryN.json" with the contents of "SorceryN.inkcontent".

Also provided is a "xtract_all_obbs.sh" which will extract all Sorcery! OBBs and link all JSON files for easier browsing.

## TODO

- [ ] Create a OBB directory abstraction layer;
- [ ] Determine main story filename using "StoryFilename" and "[StoryFilename]PartNumber" properties from "Info.plist" file instead of hard-coding;
- [ ] Use "indexed-content/filename" attribute in story file to determine inkcontent file instead of hard-coding;
- [ ] Support for other Inkle games;
- [ ] Support for generating new OBB files;
- [ ] Decompile the reference file into [Ink script](https://github.com/inkle/ink);
- [ ] Use a different JSON tokenizer.
- [ ] Get Coverity working again once it supports GCC8/c++17
- [ ] Figure out what the ktx files are on the Steam version

## Notes on file types

Most of the extracted files should be easily readable. There are two file types that need some additional care: the img and ktx files. These files are always paired up as such:

- either a `<filename>.img` + `<filename>.ktx` pair;
- or a `<filename>.img` + `<filename>.ktx` + `<filename>.alpha.ktx` triple.

The img files are metadata for the corresponding ktx file(s); they are always 20 bytes long, being composed of 5 little endian 4-byte integers:

- Always a 3 or 4; I believe this is the number of channels in the composed texture
- Width of texture
- Height of texture
- Width of alpha texture
- Height of alpha texture

The ktx files are trickier: in the Android version (and, presumably, the iOS version), they are [Khronos Textures](https://www.khronos.org/ktx/), and typically comes in pairs: one `<filename>.ktx` and one `<filename>.alpha.ktx`. The alpha file, when present, must be merged in as an alpha channel in the "main" ktx file, and they must both be resized according to the metadata in the corresponding img file. You can obtain software for reading ktx files [here](https://github.com/KhronosGroup/KTX-Software/wiki).

In the Steam version, the ktx files are in a different format, and the separate alpha files do not exist; what format these are in is unknown at this time.
